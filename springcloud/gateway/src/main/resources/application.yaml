# ========== CONFIGURACIÓN BÁSICA DE LA APLICACIÓN ==========
server:
  port: 8443
  ssl:
    bundle: gateway

spring:
  application:
    name: gateway
  config:
    activate:
      on-profile: default
  
  # ========== CONFIGURACIÓN SSL ==========
  ssl:
    bundle:
      jks:
        gateway:
          key:
            alias: localhost
          keystore:
            type: PKCS12
            location: classpath:keystore/edge.p12
            password: changeit
  
  # ========== CONFIGURACIÓN DE SEGURIDAD ==========
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://${app.auth-server}:9999
  
  # ========== CONFIGURACIÓN GATEWAY ==========
  cloud:
    gateway:
      server:
        webflux:
          trusted-proxies: ".*"
          routes:
            # Autenticación
            - id: oauth2-server
              uri: lb://authserver
              predicates:
                - Path=/oauth2/**
            - id: oauth2-login
              uri: lb://authserver
              predicates:
                - Path=/login/**
            - id: oauth2-error
              uri: lb://authserver
              predicates:
                - Path=/error/**
            
            # Servicios de aplicación
            - id: candidate-composite
              uri: lb://candidate-composite
              predicates:
                - Path=/candidate-composite/**
            - id: candidate-composite-swagger-ui
              uri: lb://candidate-composite
              predicates:
                - Path=/openapi/**
            
            # Eureka UI y API
            - id: eureka-api
              uri: http://${app.eureka-server}:8761
              predicates:
                - Path=/eureka/api/{segment}
              filters:
                - SetPath=/eureka/{segment}
            - id: eureka-web-start
              uri: http://${app.eureka-server}:8761
              predicates:
                - Path=/eureka/web
              filters:
                - SetPath=/
            - id: eureka-web-other
              uri: http://${app.eureka-server}:8761
              predicates:
                - Path=/eureka/**

# ========== CONFIGURACIÓN EUREKA ==========
eureka:
  client:
    serviceUrl:
      defaultZone: "http://${app.eureka-username}:${app.eureka-password}@${app.eureka-server}:8761/eureka/"
    initialInstanceInfoReplicationIntervalSeconds: 5
    registryFetchIntervalSeconds: 5
  instance:
    leaseRenewalIntervalInSeconds: 5
    leaseExpirationDurationInSeconds: 5

# ========== CONFIGURACIÓN MANAGEMENT ==========
management:
  endpoint:
    gateway:
      enabled: true
    health:
      show-details: "ALWAYS"
  endpoints:
    web:
      exposure:
        include: '*'

# ========== CONFIGURACIÓN LOGGING ==========
logging:
  level:
    root: INFO
    org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator: INFO
    org.springframework.cloud.gateway: TRACE
    org.springframework.web.server.adapter.HttpWebHandlerAdapter: TRACE

# ========== VARIABLES DE APLICACIÓN ==========
app:
  auth-server: localhost
  eureka-server: localhost
  eureka-username: u
  eureka-password: p

---
# ========== CONFIGURACIÓN DOCKER ==========
spring:
  config:
    activate:
      on-profile: docker

app:
  eureka-server: eureka
  auth-server: https://dev-ytiqdtrd7n283l1w.us.auth0.com/
